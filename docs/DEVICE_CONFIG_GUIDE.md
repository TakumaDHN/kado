# デバイス設定ガイド

## 概要

このガイドでは、登録済みの7台のセンサーデバイスの設定（設備名、場所、説明）をカスタマイズする方法を説明します。

## デバイス設定ファイル

**ファイル:** `app/device_config.py`

このファイルには、ESP32ゲートウェイに登録されている7台のセンサーデバイスの情報が定義されています。

## 現在の登録デバイス

| MAC アドレス | 設備名 | 場所 | 説明 |
|-------------|--------|------|------|
| ECDA3BBE61E8 | 設備1号機 | 製造ライン A | メイン生産機 |
| B08184044C94 | 設備2号機 | 製造ライン A | サブ生産機 |
| 188B0E936AF8 | 設備3号機 | 製造ライン B | 検査機 |
| 188B0E93DAD8 | 設備4号機 | 製造ライン B | 梱包機 |
| 188B0E91ABD4 | 設備5号機 | 製造ライン C | 加工機 |
| 188B0E915D9C | 設備6号機 | 製造ライン C | 組立機 |
| 188B0E93B5D4 | 設備7号機 | 製造ライン C | 出荷検査機 |

## カスタマイズ方法

### 1. 設定ファイルを開く

テキストエディタで `app/device_config.py` を開きます。

```cmd
notepad app\device_config.py
```

### 2. デバイス情報を編集

```python
REGISTERED_DEVICES = {
    "ECDA3BBE61E8": {
        "name": "設備1号機",           # ← ここを変更
        "location": "製造ライン A",      # ← ここを変更
        "description": "メイン生産機",   # ← ここを変更
        "index": 0  # 表示順序（0-6）
    },
    # 他のデバイスも同様に編集...
}
```

### 3. 編集例

実際の工場に合わせて編集する例：

```python
REGISTERED_DEVICES = {
    "ECDA3BBE61E8": {
        "name": "プレス機A",
        "location": "第1工場 北棟",
        "description": "大型プレス機（500t）",
        "index": 0
    },
    "B08184044C94": {
        "name": "切削機B",
        "location": "第1工場 南棟",
        "description": "CNC切削機",
        "index": 1
    },
    "188B0E936AF8": {
        "name": "溶接ロボット1",
        "location": "第2工場",
        "description": "自動溶接装置",
        "index": 2
    },
    "188B0E93DAD8": {
        "name": "塗装ブース",
        "location": "第2工場",
        "description": "自動塗装設備",
        "index": 3
    },
    "188B0E91ABD4": {
        "name": "組立ライン1",
        "location": "第3工場",
        "description": "最終組立ライン",
        "index": 4
    },
    "188B0E915D9C": {
        "name": "検査装置A",
        "location": "品質管理室",
        "description": "外観検査機",
        "index": 5
    },
    "188B0E93B5D4": {
        "name": "梱包機",
        "location": "出荷エリア",
        "description": "自動梱包装置",
        "index": 6
    }
}
```

### 4. 変更を保存

ファイルを保存します。

### 5. Webアプリを再起動

変更を反映するには、Webアプリを再起動します：

```cmd
# 現在のアプリを停止（Ctrl+C）
# 再度起動
run_webapp.bat
```

または

```cmd
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

**注意:** `--reload` オプションを使用している場合は、ファイルを保存すると自動的に再起動されます。

## フィールド説明

### name（必須）
- **用途:** ダッシュボードに表示される設備名
- **文字数:** 推奨15文字以内
- **例:** "プレス機A", "溶接ロボット1", "検査装置"

### location（必須）
- **用途:** 設備の設置場所
- **文字数:** 推奨20文字以内
- **例:** "第1工場 北棟", "製造ライン A", "品質管理室"

### description（必須）
- **用途:** 設備の詳細説明
- **文字数:** 推奨30文字以内
- **例:** "大型プレス機（500t）", "自動溶接装置", "外観検査機"

### index（必須）
- **用途:** ダッシュボードでの表示順序
- **値:** 0〜6の整数
- **注意:** 重複しないこと

## ダッシュボードでの表示

編集後、ダッシュボード（http://localhost:8000）で以下のように表示されます：

```
┌──────────────────────────┐
│ プレス機A        [稼働中] │
│ 第1工場 北棟              │
│ 大型プレス機（500t）      │
│                          │
│ 🔴 🟡 🟢               │
│                          │
│ バッテリー残量: 85%       │
│ 最終更新: 2025-01-22...  │
│ MAC: ECDA3BBE61E8        │
└──────────────────────────┘
```

## よくある質問

### Q1: MACアドレスを変更できますか？

**A:** MACアドレスは変更できません。これはESP32センサーのハードウェアIDです。設備名、場所、説明のみ変更可能です。

### Q2: デバイスを追加できますか？

**A:** 追加できますが、ESP32ゲートウェイ側の設定も必要です。

1. `JP_LightTowerUpdate_LAN_1.4.0.ino` の `clientESP[]` 配列にMACアドレスを追加
2. `app/device_config.py` の `REGISTERED_DEVICES` に追加
3. 両方を更新して再起動

### Q3: デバイスを削除できますか？

**A:** できますが、推奨しません。データが来なくても「オフライン」として表示されます。削除する場合：

1. `app/device_config.py` から該当エントリを削除
2. データベースから削除（または `lighttower.db` を削除して再作成）

### Q4: 日本語以外を使用できますか？

**A:** はい、英語や他の言語も使用可能です。

```python
"ECDA3BBE61E8": {
    "name": "Press Machine A",
    "location": "Factory 1 - North Wing",
    "description": "Large Press Machine (500t)",
    "index": 0
}
```

## トラブルシューティング

### 変更が反映されない

1. ファイルを保存したか確認
2. Webアプリを再起動（Ctrl+C → 再起動）
3. ブラウザをリロード（Ctrl+F5）

### 起動時にエラーが出る

**構文エラーの可能性:**
```python
# 間違い（カンマ忘れ）
"name": "設備1号機"
"location": "製造ライン A"  # ← エラー

# 正しい
"name": "設備1号機",
"location": "製造ライン A",
```

**括弧の不一致:**
```python
# 全ての { } が正しく閉じられているか確認
REGISTERED_DEVICES = {
    "ECDA3BBE61E8": {
        ...
    },  # ← カンマ必要
    "B08184044C94": {
        ...
    }  # ← 最後はカンマ不要
}
```

### デバイスが表示されない

1. MACアドレスが正しいか確認（大文字で入力）
2. `index` が0〜6の範囲内か確認
3. すべてのフィールド（name, location, description, index）が存在するか確認

## 設定ファイルのバックアップ

変更前にバックアップを作成することを推奨します：

```cmd
copy app\device_config.py app\device_config.py.backup
```

復元する場合：

```cmd
copy app\device_config.py.backup app\device_config.py
```

## 参考

- ESP32ゲートウェイ設定: `JP_LightTowerUpdate_LAN_1.4.0.ino` (37行目)
- データフォーマット: `DATA_FORMAT.md`
- Webアプリガイド: `WEBAPP_GUIDE.md`
